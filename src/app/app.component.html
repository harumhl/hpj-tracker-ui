<!-- Notes -->
<div *ngIf="display.notes" (dblclick)="toggle('notes', !display.notes)">
  <div *ngFor="let note of this.notes">
    <span style="white-space: pre; word-wrap: normal;" [innerHTML]="'- ' + note.name + ': ' + note.text | highlight : note.highlights"></span>
    <br>
  </div>
  <br>
</div>

<!-- TODO put everything in the center of the screen? -->
<!-- todo week-by-week completion rate chart? -->
<!-- Chart -->
<div *ngIf="display.topChart" (dblclick)="toggle('topChart', !display.topChart)">
  <div style="display: inline-block"> <!-- inline-block displays <div>s side by side -->
    <ejs-chart #topChart id="completion-hours-by-categories-as-percentage-chart" width="300" height="200" [legendSettings]="{visible: false}"
               [primaryXAxis]="{valueType:'Category', title: '', labelPosition: 'Inside'}"
               [primaryYAxis]="{minimum: 0, maximum: 100, interval: 20, title: '',
                 stripLines: [{start: 65, end: 85, text: 'Feb-Mar goal', color: 'pink', opacity: 0.5, visible: true}]}">
      <e-series-collection>
        <e-series [dataSource]='this.completionPercentageByCategories' type='Bar' xName='category' yName='percent' name="hours as percent"
                  [marker]="{dataLabel: {visible: true, position: 'Top', font: {fontWeight: '600', color: '#ffffff'}}}"></e-series>
      </e-series-collection>
    </ejs-chart>
  </div>
</div>

<!-- todo refresh button to refresh today's entry -->
<!-- Today's completion rate & today's date & display option checkbox -->
<label [ngClass]="{
      'twenty-percent-done': 20 <= overallCompletionRate && overallCompletionRate < 40,
      'forty-percent-done': 40 <= overallCompletionRate && overallCompletionRate < 60,
      'sixty-percent-done': 60 <= overallCompletionRate && overallCompletionRate < 80,
      'eighty-percent-done': 80 <= overallCompletionRate && overallCompletionRate < 100,
      'hundred-percent-done': overallCompletionRate >= 100}" style="color: red">
  {{overallCompletionRate | number : '0.2-2'}}%</label>
({{dbService.today}} {{dbService.dayOfToday}})
<input id="edit" type="checkbox" [checked]="editMode" (change)="editMode = !editMode">
<label for="edit">edit</label>
<input id="displayAllOptions" type="checkbox" [checked]="display.allOptions" (change)="toggle('allOptions', !display.allOptions)">
<label for="displayAllOptions">options</label>
<button style="width: 60px; height: 20px" (click)="this.readEntriesOfToday(true); this.computeCompletionPercentageByCategories()">refresh</button>

<!-- TODO some 'classification' on what I can do in given situations (if I'm out and wearing masks -> smile or mewing / if I'm with friends -> ??)
          -> currently I just have it in Notes in prod -->
<!-- todo web is getting slower, so put a spinning wheel while processing -->
<!-- display checkboxes -->
<div *ngIf="display.allOptions">
  <input id="displayIncompleteAndUnhiddenOnly" type="checkbox" [checked]="display.incompleteAndUnhiddenOnly" (change)="toggle('incompleteAndUnhiddenOnly', !display.incompleteAndUnhiddenOnly)">
  <label for="displayIncompleteAndUnhiddenOnly">incomplete & unhidden only</label><br>
  <input id="displayFullInfo" type="checkbox" [checked]="display.fullInfo" (change)="toggle('fullInfo', !display.fullInfo)">
  <label for="displayFullInfo">full display</label><br>
  <input id="displayInSchedules" type="checkbox" [checked]="display.inSchedules" (change)="toggle('inSchedules', !display.inSchedules)">
  <label for="displayInSchedules">in schedule</label><br>
  <input id="displayTopChart" type="checkbox" [checked]="display.topChart" (change)="toggle('topChart',!display.topChart)">
  <label for="displayTopChart">display chart</label><br>
  <input id="displayNotes" type="checkbox" [checked]="display.notes" (change)="toggle('notes',!display.notes)">
  <label for="displayNotes">display notes</label><br>
  <input id="displayBasics" type="checkbox" [checked]="display.basics" (change)="toggle('basics', !display.basics)">
  <label for="displayBasics">display basics</label><br>
  <input id="displayTesting" type="checkbox" [checked]="display.testing" (change)="toggle('testing', !display.testing)">
  <label for="displayTesting">display testing</label>
</div>
<br>

<!-- edit mode options -->
<button *ngIf="editMode" (click)="applyEditMode('hide')">hide</button>
<button *ngIf="editMode" (click)="applyEditMode('unhide')">unhide</button>
<button *ngIf="editMode" (click)="applyEditMode('unhideAll')">unhide all</button>

<!-- Log in to see data -->
<label id="emailLabel" for="emailInput"> email: </label>
<input id="emailInput" value={{this.email}}>
<label id="passwordLabel" for="passwordInput"> password: </label>
<input id="passwordInput" type="password">
<button id="login" (click)="login()">login</button>

<!-- Displaying data -->
<div id="main-table-div" style="display: block; overflow: scroll" class="div-table">
  <subentry-table *ngIf="dataToDisplay.length > 0" [loggedIn]="loggedIn" [headers]="headers" [disable]="disableMainInput"
                  [dataToDisplay]="this.dataToDisplay" [timeToHighlight]="timeToHighlight" [editMode]="this.editMode"
                  [categoryColors]="categoryColors" [date]="this.dbService._getDateKey()" [mobile]="this.mobile">
  </subentry-table>
</div>

<!-- (Testing) Update Basics (sleep, food, mood) -->
<div *ngIf="display.basics" (click)="toggle('basics', !display.basics)">
  <textarea id="updatedBasics" style="width: 100%; height: 250px" [innerHTML]="basics | json"></textarea>
  <button (click)="updateBasics()">Save Basics</button><br>
</div>

{{version}} {{environment}} {{buildTimestamp}}

<!-- Testing -->
<br>
<div (dblclick)="display.testing = false">
  <!-- (Testing) Enter a new goal -->
  <div [hidden]="!display.testing">
    <form (submit)="save('New Goal')">
      <label>New goal: </label>
      <select id="newGoalCategory" [disabled]="loggedIn === false">
        <option *ngFor="let category of categoryList" value="{{category}}">{{category}}</option>
      </select>
      <input id="newGoalName" placeholder="name" style="width: 100px" [disabled]="loggedIn === false" required>
      <input id="newGoalGoalCount" type="number" placeholder="goalCount" style="width: 70px" [disabled]="loggedIn === false" required>
      <input id="newGoalUnit" placeholder="unit" style="width: 50px" [disabled]="loggedIn === false" required>
      <input id="newGoalCountToMinutes" placeholder="count to minutes" style="width: 100px" [disabled]="loggedIn === false" required>
      <input id="newGoalExpectedTimesOfCompletion" placeholder="time to complete" style="width: 100px" [disabled]="loggedIn === false" required>
      <input id="newGoalSubentryDetails" placeholder="subentryDetails" style="width: 100px" [disabled]="loggedIn === false">
      <input id="newGoalDetails" placeholder="details" style="width: 100px" [disabled]="loggedIn === false">
      <input type="submit" value="save">
    </form>
  </div>
  <app-modify-task [loggedIn]="loggedIn"
                   [categories]="categories" [categoryList]="categoryList" [templateTask]="this.tasks[0]"
                   [tasks]="tasks" [taskList]="taskList"></app-modify-task>

  <!-- (Testing) Update an existing goal -->
  <div [hidden]="!display.testing">
    <form (ngSubmit)="save('Modify Goal')">
      <label>Modify goal: </label>
      <select id="modifyGoalName" [disabled]="loggedIn === false" (change)="updateModifyInputElements('Modify Goal')">
        <option *ngFor="let name of taskList" value="{{name}}">{{name}}</option>
      </select>
      <input id="modifyGoalGoalCount" type="number" placeholder="goalCount" style="width: 70px" [disabled]="loggedIn === false">
      <input id="modifyGoalUnit" placeholder="unit" style="width: 50px" [disabled]="loggedIn === false">
      <input id="modifyGoalCountToMinutes" placeholder="count to minutes" style="width: 100px" [disabled]="loggedIn === false">
      <input id="modifyGoalExpectedTimesOfCompletion" placeholder="time to complete" style="width: 100px" [disabled]="loggedIn === false">
      <input id="modifyGoalSubentryDetails" placeholder="subentryDetails" style="width: 100px" [disabled]="loggedIn === false">
      <input id="modifyGoalDetails" placeholder="details" style="width: 100px" [disabled]="loggedIn === false">
      <input type="submit" value="save">
    </form>
  </div>

  {{saveMessage}}
  <br *ngIf="saveMessage.length > 0">

  <!-- TODO Categories has "details" to have this kinda info (e.g. category 'Hazel' is only for Hazel not for both) -->
  <!-- todo display entries of past dates -->
  <!-- (Testing) display all categories and goals -->
  <subentry-table [hidden]="!display.testing" [loggedIn]="loggedIn" [headers]="['name']"
                  [dataToDisplay]="this.categories" [mobile]="this.mobile"></subentry-table>
  <br>

  <label [hidden]="!display.testing">{{this.activeTasks.length}} active goals </label>
  <label [hidden]="!display.testing" style="background-color: #FF9999">({{this.archivedTasks.length}} archived goals)</label>
  <subentry-table [hidden]="!display.testing" [loggedIn]="loggedIn" [headers]="['category', 'name', 'archived', 'goalCount', 'unit', 'expectedTimesOfCompletion', 'subentryDetails', 'details']"
                  [dataToDisplay]="sortByCategory(this.tasks)" [categoryColors]="categoryColors" [mobile]="this.mobile"></subentry-table>
  <br>

  <!-- (Testing) display data of past 7 days -->
  <label [hidden]="!display.testing">'count' is for yesterday's entry</label>
  <subentry-table [hidden]="!display.testing" [loggedIn]="loggedIn" [headers]="headersPast" [dataToDisplay]="this.dataQueriedPast"
                  [categoryColors]="categoryColors" [date]="yesterday" [mobile]="this.mobile">
  </subentry-table>
</div>

<!-- todo: charts
  - display completion rates over days for multiple goals (with selection options)
  - allow changing the timeline
-->
<!-- todo: notifications -->
<!-- todo: handling money - based on the daily progress, move money from 'maybe' account to 'donate' and 'free to use' accounts -->
